---
sidebar: sidebar 
permalink: openshift/os-pm-aws-dp.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMWare, provider managed storage, ONTAP, AWS FSx ONTAP, Astra Control Service 
summary:  
---
= Protezione dei dati
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Questa pagina mostra le opzioni di protezione dei dati per i cluster Managed Red Hat OpenShift on AWS (ROSA) che utilizzano Astra Control Service.  Astra Control Service (ACS) fornisce un'interfaccia utente grafica di facile utilizzo con cui è possibile aggiungere cluster, definire le applicazioni in esecuzione su di essi ed eseguire attività di gestione dei dati basate sulle applicazioni.  È possibile accedere alle funzioni ACS anche tramite un'API che consente l'automazione dei flussi di lavoro.

Astra Control (ACS o ACC) è alimentato da NetApp Trident.  Trident integra diversi tipi di cluster Kubernetes, come Red Hat OpenShift, EKS, AKS, SUSE Rancher, Anthos ecc., con vari tipi di storage NetApp ONTAP , come FAS/ AFF, ONTAP Select, CVO, Google Google Cloud NetApp Volumes, Azure NetApp Files e Amazon FSx ONTAP.

Questa sezione fornisce dettagli sulle seguenti opzioni di protezione dei dati tramite ACS:

* Un video che mostra il backup e il ripristino di un'applicazione ROSA in esecuzione in una regione e il ripristino in un'altra regione.
* Un video che mostra lo snapshot e il ripristino di un'applicazione ROSA.
* Dettagli passo passo sull'installazione di un cluster ROSA, Amazon FSx ONTAP, utilizzando NetApp Trident per l'integrazione con il backend di storage, installando un'applicazione PostgreSQL sul cluster ROSA, utilizzando ACS per creare uno snapshot dell'applicazione e ripristinandola da esso.
* Un blog che illustra dettagliatamente la creazione e il ripristino da uno snapshot per un'applicazione MySQL su un cluster ROSA con FSx ONTAP utilizzando ACS.




== Backup/Ripristino da backup

Il video seguente mostra il backup di un'applicazione ROSA in esecuzione in una regione e il ripristino in un'altra regione.

.FSx NetApp ONTAP per Red Hat OpenShift Service su AWS
video::01dd455e-7f5a-421c-b501-b01200fa91fd[panopto]


== Snapshot/Ripristina da snapshot

Il video seguente mostra come acquisire uno snapshot di un'applicazione ROSA e come ripristinarlo successivamente.

.Snapshot/ripristino per applicazioni su cluster Red Hat OpenShift Service on AWS (ROSA) con storage Amazon FSx ONTAP
video::36ecf505-5d1d-4e99-a6f8-b11c00341793[panopto]


== Blog

* link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Using-Astra-Control-Service-for-data-management-of-apps-on-ROSA-clusters-with/ba-p/450903["Utilizzo di Astra Control Service per la gestione dei dati delle app sui cluster ROSA con storage Amazon FSx"]




== Dettagli passo passo per creare uno snapshot e ripristinarlo



=== Configurazione prerequisito

* link:https://signin.aws.amazon.com/signin?redirect_uri=https://portal.aws.amazon.com/billing/signup/resume&client_id=signup["Account AWS"]
* link:https://console.redhat.com/["Account Red Hat OpenShift"]
* Utente IAM conlink:https://www.rosaworkshop.io/rosa/1-account_setup/["permessi appropriati"] per creare e accedere al cluster ROSA
* link:https://aws.amazon.com/cli/["Interfaccia a riga di comando AWS"]
* link:https://console.redhat.com/openshift/downloads["ROSA CLI"]
* link:https://console.redhat.com/openshift/downloads["Interfaccia a riga di comando di OpenShift"](oc)
* VPC con subnet e gateway e percorsi appropriati
* link:https://docs.openshift.com/rosa/rosa_install_access_delete_clusters/rosa_getting_started_iam/rosa-installing-rosa.html["ROSA Cluster installato"]nel VPC
* link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started-step1.html["Amazon FSx ONTAP"]creato nella stessa VPC
* Accesso al cluster ROSA dalink:https://console.redhat.com/openshift/overview["Console cloud ibrida OpenShift"]




=== Prossimi passi

. Crea un utente amministratore ed effettua l'accesso al cluster.
. Creare un file kubeconfig per il cluster.
. Installare Trident sul cluster.
. Creare una configurazione di backend, classe di archiviazione e classe di snapshot utilizzando il provisioner Trident CSI.
. Distribuire un'applicazione PostgreSQL sul cluster.
. Crea un database e aggiungi un record.
. Aggiungere il cluster in ACS.
. Definire l'applicazione in ACS.
. Crea uno snapshot utilizzando ACS.
. Eliminare il database nell'applicazione PostgreSQL.
. Ripristina da uno snapshot tramite ACS.
. Verifica che l'app sia stata ripristinata dallo snapshot.




==== **1. Crea un utente amministratore e accedi al cluster**

Accedi al cluster ROSA creando un utente amministratore con il seguente comando: (È necessario creare un utente amministratore solo se non ne hai creato uno al momento dell'installazione)

`rosa create admin --cluster=<cluster-name>`

Il comando fornirà un output simile al seguente.  Accedi al cluster utilizzando `oc login` comando fornito nell'output.

image:rhhc-rosa-cluster-admin-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]


NOTE: È anche possibile accedere al cluster tramite un token.  Se al momento della creazione del cluster è già stato creato un utente amministratore, è possibile accedere al cluster dalla console Red Hat OpenShift Hybrid Cloud con le credenziali dell'utente amministratore.  Quindi cliccando nell'angolo in alto a destra dove è visualizzato il nome dell'utente registrato, è possibile ottenere il `oc login` comando (accesso token) per la riga di comando.



==== **2. Crea un file kubeconfig per il cluster**

Seguire le procedurelink:https://docs.netapp.com/us-en/astra-control-service/get-started/create-kubeconfig.html#create-a-kubeconfig-file-for-red-hat-openshift-service-on-aws-rosa-clusters["Qui"] per creare un file kubeconfig per il cluster ROSA.  Questo file kubeconfig verrà utilizzato in seguito quando aggiungerai il cluster ad ACS.



==== **3. Installa Trident sul cluster**

Installare Trident (ultima versione) sul cluster ROSA.  Per fare ciò, puoi seguire una qualsiasi delle procedure fornitelink:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy.html["Qui"] .  Per installare Trident tramite helm dalla console del cluster, creare prima un progetto denominato Trident.

image:rhhc-trident-project-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

Quindi, dalla vista Sviluppatore, crea un repository di grafici Helm.  Per il campo URL utilizzare `'https://netapp.github.io/trident-helm-chart'` .  Quindi creare una versione del timone per l'operatore Trident .

image:rhhc-helm-repo-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"] image:rhhc-helm-release-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

Verificare che tutti i pod Trident siano in esecuzione tornando alla vista Amministratore sulla console e selezionando i pod nel progetto Trident.

image:rhhc-trident-installed.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **4. Crea una configurazione di backend, classe di archiviazione e classe di snapshot utilizzando il provisioner Trident CSI**

Utilizzare i file yaml mostrati di seguito per creare un oggetto backend trident, un oggetto classe di archiviazione e l'oggetto Volumesnapshot.  Assicurati di fornire le credenziali del file system Amazon FSx ONTAP che hai creato, il LIF di gestione e il nome del vserver del tuo file system nel file yaml di configurazione per il backend.  Per ottenere questi dettagli, accedi alla console AWS per Amazon FSx e seleziona il file system, quindi vai alla scheda Amministrazione.  Inoltre, fare clic su Aggiorna per impostare la password per `fsxadmin` utente.


NOTE: È possibile utilizzare la riga di comando per creare gli oggetti oppure crearli con i file yaml dalla console del cloud ibrido.

image:rhhc-fsx-details.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

**Configurazione backend Trident **

[source, yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-nas-secret
type: Opaque
stringData:
  username: fsxadmin
  password: <password>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: ontap-nas
spec:
  version: 1
  storageDriverName: ontap-nas
  managementLIF: <management lif>
  backendName: ontap-nas
  svm: fsx
  credentials:
    name: backend-tbc-ontap-nas-secret
----
**Classe di archiviazione**

[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ontap-nas
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-nas"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true
----
**classe snapshot**

[source, yaml]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: trident-snapshotclass
driver: csi.trident.netapp.io
deletionPolicy: Delete
----
Verificare che gli oggetti backend, storage class e trident-snapshotclass siano stati creati emettendo i comandi mostrati di seguito.

image:rhhc-tbc-sc-verify.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

A questo punto, una modifica importante da apportare è impostare ontap-nas come classe di archiviazione predefinita anziché gp3, in modo che l'app PostgreSQL che distribuirai in seguito possa utilizzare la classe di archiviazione predefinita.  Nella console Openshift del tuo cluster, in Storage seleziona StorageClasses.  Modificare l'annotazione della classe predefinita corrente su false e aggiungere l'annotazione storageclass.kubernetes.io/is-default-class impostata su true per la classe di archiviazione ontap-nas.

image:rhhc-change-default-sc.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

image:rhhc-default-sc.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **5. Distribuisci un'applicazione PostgreSQL sul cluster**

È possibile distribuire l'applicazione dalla riga di comando come segue:

`helm install postgresql bitnami/postgresql -n postgresql --create-namespace`

image:rhhc-postgres-install.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]


NOTE: Se non vedi i pod dell'applicazione in esecuzione, potrebbe essersi verificato un errore dovuto a vincoli del contesto di sicurezza. image:rhhc-scc-error.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"] Correggi l'errore modificando il `runAsUser` E `fsGroup` campi in `statefuleset.apps/postgresql` oggetto con l'uid che si trova nell'output del `oc get project` comando come mostrato di seguito.image:rhhc-scc-fix.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

L'app PostgreSQL deve essere in esecuzione e utilizzare volumi persistenti supportati dallo storage Amazon FSx ONTAP .

image:rhhc-postgres-running.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

image:rhhc-postgres-pvc.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **6. Crea un database e aggiungi un record**

image:rhhc-postgres-db-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **7. Aggiungi il cluster in ACS**

Accedi ad ACS.  Selezionare il cluster e fare clic su Aggiungi.  Seleziona altro e carica o incolla il file kubeconfig.

image:rhhc-acs-add-001.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

Fare clic su *Avanti* e selezionare ontap-nas come classe di archiviazione predefinita per ACS.  Fare clic su *Avanti*, rivedere i dettagli e *Aggiungere* il cluster.

image:rhhc-acs-add-002.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **8. Definire l'applicazione in ACS**

Definire l'applicazione PostgreSQL in ACS.  Dalla landing page, seleziona *Applicazioni*, *Definisci* e compila i dettagli appropriati.  Fare clic su *Avanti* un paio di volte, rivedere i dettagli e fare clic su *Definisci*.  L'applicazione viene aggiunta ad ACS.

image:rhhc-acs-add-002.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **9. Crea uno snapshot utilizzando ACS**

Esistono molti modi per creare uno snapshot in ACS.  È possibile selezionare l'applicazione e creare uno snapshot dalla pagina che mostra i dettagli dell'applicazione.  È possibile fare clic su Crea snapshot per creare uno snapshot su richiesta o configurare un criterio di protezione.

Per creare uno snapshot on-demand, basta cliccare su *Crea snapshot*, specificare un nome, esaminare i dettagli e cliccare su *Snapshot*.  Una volta completata l'operazione, lo stato dello snapshot cambia in Integro.

image:rhhc-snapshot-create.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

image:rhhc-snapshot-on-demand.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **10. Elimina il database nell'applicazione PostgreSQL**

Accedi nuovamente a PostgreSQL, elenca i database disponibili, elimina quello creato in precedenza ed esegui nuovamente l'elenco per assicurarti che il database sia stato eliminato.

image:rhhc-postgres-db-delete.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **11. Ripristina da uno snapshot utilizzando ACS**

Per ripristinare l'applicazione da uno snapshot, vai alla landing page dell'interfaccia utente di ACS, seleziona l'applicazione e seleziona Ripristina.  È necessario scegliere uno snapshot o un backup da cui effettuare il ripristino.  (In genere, ne verrebbero creati più di uno in base a una policy configurata).  Effettuare le scelte appropriate nelle schermate successive e quindi fare clic su *Ripristina*.  Dopo il ripristino dall'istantanea, lo stato dell'applicazione passa da Ripristino in corso a Disponibile.

image:rhhc-app-restore-001.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

image:rhhc-app-restore-002.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

image:rhhc-app-restore-003.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]



==== **12. Verifica che la tua app sia stata ripristinata dallo snapshot**

Accedi al client PostgreSQL e dovresti ora vedere la tabella e il record nella tabella che avevi in precedenza.  Questo è tutto.  Basta cliccare su un pulsante e la tua applicazione verrà ripristinata a uno stato precedente.  Ecco quanto è semplice per i nostri clienti il nostro lavoro con Astra Control.

image:rhhc-app-restore-verify.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]
