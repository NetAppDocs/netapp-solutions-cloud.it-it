---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-migrate-hcx.html 
keywords: gcp, gcve, hybrid, multicloud, migrate, vmware, hcx, google, cloud, enterprise, hybrid, cloud, migration 
summary:  
---
= Migrazione dei carichi di lavoro al datastore Google Cloud NetApp Volumes su Google Cloud VMware Engine utilizzando VMware HCX - Guida introduttiva
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Uno dei casi d'uso più comuni per il datastore Google Cloud VMware Engine e Cloud Volume Service è la migrazione dei carichi di lavoro VMware.  VMware HCX è un'opzione preferita e fornisce vari meccanismi di migrazione per spostare le macchine virtuali (VM) locali e i relativi dati nei datastore NFS di Cloud Volume Service.



== Panoramica: migrazione di macchine virtuali con VMware HCX, datastore Google Cloud NetApp Volumes e Google Cloud VMware Engine (GCVE)

VMware HCX è principalmente una piattaforma di migrazione progettata per semplificare la migrazione delle applicazioni, il ribilanciamento del carico di lavoro e persino la continuità aziendale tra i cloud.  È incluso come parte di Google Cloud VMware Engine Private Cloud e offre numerose modalità per migrare i carichi di lavoro e può essere utilizzato per operazioni di disaster recovery (DR).

Questo documento fornisce una guida dettagliata per il provisioning del datastore di Cloud Volume Service, seguito dal download, dalla distribuzione e dalla configurazione di VMware HCX, inclusi tutti i suoi componenti principali in locale e sul lato Google Cloud VMware Engine, tra cui Interconnect, Network Extension e ottimizzazione WAN per abilitare vari meccanismi di migrazione delle VM.


NOTE: VMware HCX funziona con qualsiasi tipo di datastore poiché la migrazione avviene a livello di VM.  Pertanto, il presente documento è applicabile ai clienti NetApp esistenti e NetApp che intendono implementare Cloud Volume Service con Google Cloud VMware Engine per un'implementazione cloud VMware conveniente.

.gradini di alto livello
[%collapsible%open]
====
Questo elenco fornisce i passaggi di alto livello necessari per associare e migrare le VM a HCX Cloud Manager sul lato Google Cloud VMware Engine da HCX Connector in locale:

. Preparare HCX tramite il portale Google VMware Engine.
. Scarica e distribuisci il programma di installazione di HCX Connector Open Virtualization Appliance (OVA) nel VMware vCenter Server locale.
. Attiva HCX con la chiave di licenza.
. Associa VMware HCX Connector on-premise a Google Cloud VMware Engine HCX Cloud Manager.
. Configurare il profilo di rete, il profilo di elaborazione e il service mesh.
. (Facoltativo) Eseguire l'estensione di rete per evitare il re-IP durante le migrazioni.
. Convalidare lo stato dell'appliance e assicurarsi che la migrazione sia possibile.
. Migrare i carichi di lavoro delle VM.


====
.Prerequisiti
[%collapsible%open]
====
Prima di iniziare, assicurati che siano soddisfatti i seguenti prerequisiti.  Per maggiori informazioni, vedere questo https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["collegamento"^] .  Una volta soddisfatti i prerequisiti, inclusa la connettività, scarica la chiave di licenza HCX dal portale Google Cloud VMware Engine.  Dopo aver scaricato il programma di installazione OVA, procedere con il processo di installazione come descritto di seguito.


NOTE: HCX Advanced è l'opzione predefinita, mentre VMware HCX Enterprise Edition è disponibile anche tramite ticket di supporto e supportata senza costi aggiuntivi.  Fare riferimento https://cloud.google.com/blog/products/compute/whats-new-with-google-cloud-vmware-engine["questo collegamento"^]

* Utilizzare un data center software-defined (SDDC) Google Cloud VMware Engine esistente o creare un cloud privato utilizzando questolink:vmw-gcp-gcve-setup.html["Collegamento NetApp"^] o questo https://cloud.google.com/vmware-engine/docs/create-private-cloud["Collegamento Google"^] .
* La migrazione delle VM e dei dati associati dal data center locale abilitato per VMware vSphere richiede la connettività di rete dal data center all'ambiente SDDC.  Prima di migrare i carichi di lavoro, https://cloud.google.com/vmware-engine/docs/networking/howto-connect-to-onpremises["impostare una connessione Cloud VPN o Cloud Interconnect"^] tra l'ambiente on-premise e il rispettivo cloud privato.
* Il percorso di rete dall'ambiente VMware vCenter Server on-premise al cloud privato Google Cloud VMware Engine deve supportare la migrazione delle VM tramite vMotion.
* Assicurati che il necessario https://ports.esp.vmware.com/home/VMware-HCX["regole e porte del firewall"^] sono consentiti per il traffico vMotion tra il vCenter Server locale e SDDC vCenter.
* Il volume NFS di Cloud Volume Service deve essere montato come datastore in Google Cloud VMware Engine.  Seguire i passaggi dettagliati in questo https://cloud.google.com/vmware-engine/docs/vmware-ecosystem/howto-cloud-volumes-service-datastores["collegamento"^] per collegare i datastore di Cloud Volume Service agli host Google Cloud VMware Engines.


====
.Architettura di alto livello
[%collapsible%open]
====
A scopo di test, l'ambiente di laboratorio locale utilizzato per questa convalida è stato connesso tramite una VPN cloud, che consente la connettività locale a Google Cloud VPC.

image:gcpd-hcx-001.png["Questa immagine illustra l'architettura di alto livello utilizzata in questa soluzione."]

Per maggiori dettagli sull'utilizzo di VMware HCX con Google, fare riferimento a https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["Collegamento VMware"^]

====


== Distribuzione della soluzione

Per completare l'implementazione di questa soluzione, seguire la serie di passaggi:

.Passaggio 1: preparare HCX tramite il portale Google VMware Engine
[%collapsible%open]
====
Il componente HCX Cloud Manager viene installato automaticamente quando si esegue il provisioning del cloud privato con VMware Engine.  Per preparare l'associazione del sito, completare i seguenti passaggi:

. Accedi al portale Google VMware Engine e accedi a HCX Cloud Manager.
+
Puoi accedere alla console HCX cliccando sul link della versione HCXimage:gcpd-hcx-002.png["Accesso alla console HCX con collegamento alla risorsa GCVE"] oppure facendo clic su HCX FQDN nella scheda vSphere Management Network.image:gcpd-hcx-003.png["Accesso alla console HCX con collegamento FQDN"]

. In HCX Cloud Manager, vai su *Amministrazione > Aggiornamenti di sistema*.
. Fare clic su *Richiedi collegamento per il download* e scaricare il file OVA.image:gcpd-hcx-004.png["Richiedi il link per il download"]
. Aggiornare HCX Cloud Manager all'ultima versione disponibile dall'interfaccia utente di HCX Cloud Manager.


====
.Passaggio 2: distribuire l'OVA del programma di installazione nel vCenter Server locale
[%collapsible%open]
====
Per consentire al connettore on-premise di connettersi a HCX Manager in Google Cloud VMware Engine, assicurarsi che le porte firewall appropriate siano aperte nell'ambiente on-premise.

Per scaricare e installare HCX Connector nel vCenter Server locale, completare i seguenti passaggi:

. Scaricare l'ova dalla console HCX su Google Cloud VMware Engine come indicato nel passaggio precedente.
. Dopo aver scaricato l'OVA, distribuiscilo nell'ambiente VMware vSphere locale utilizzando l'opzione *Distribuisci modello OVF*.
+
image:gcpd-hcx-005.png["Screenshot per selezionare il modello OVA corretto."]

. Immettere tutte le informazioni richieste per la distribuzione OVA, fare clic su *Avanti*, quindi su *Fine* per distribuire il connettore VMware HCX OVA.
+

NOTE: Accendere manualmente l'appliance virtuale.



Per istruzioni dettagliate, vedere il https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx#prepare-for-hcx-manager-installation["Documentazione di Google HCX"^] .

====
.Passaggio 3: Attiva HCX Connector con la chiave di licenza
[%collapsible%open]
====
Dopo aver distribuito VMware HCX Connector OVA in locale e avviato l'appliance, completare i seguenti passaggi per attivare HCX Connector.  Genera la chiave di licenza dal portale Google Cloud VMware Engine e attivala in VMware HCX Manager.

. Dal portale VMware Engine, fare clic su Risorse, selezionare il cloud privato e *fare clic sull'icona di download in HCX Manager Cloud Version*. image:gcpd-hcx-006.png["Scarica la licenza HCX"] Aprire il file scaricato e copiare la stringa della chiave di licenza.
. Accedi a VMware HCX Manager on-premise all'indirizzo `"https://hcxmanagerIP:9443"` utilizzando le credenziali di amministratore.
+

NOTE: Utilizzare l'hcxmanagerIP e la password definiti durante la distribuzione OVA.

. Nella licenza, inserisci la chiave copiata dal passaggio 3 e clicca su *Attiva*.
+

NOTE: L'HCX Connector locale deve avere accesso a Internet.

. In *Posizione del data center*, indicare la posizione più vicina per l'installazione di VMware HCX Manager in locale.  Fare clic su *Continua*.
. In *Nome sistema*, aggiorna il nome e fai clic su *Continua*.
. Fare clic su *Sì, continua*.
. In *Connetti il tuo vCenter*, fornisci il nome di dominio completo (FQDN) o l'indirizzo IP di vCenter Server e le credenziali appropriate, quindi fai clic su *Continua*.
+

NOTE: Utilizzare l'FQDN per evitare problemi di connettività in seguito.

. In *Configura SSO/PSC*, fornire l'FQDN o l'indirizzo IP del Platform Services Controller (PSC) e fare clic su *Continua*.
+

NOTE: Per Embedded PSC, immettere l'FQDN o l'indirizzo IP di VMware vCenter Server.

. Verificare che le informazioni immesse siano corrette e fare clic su *Riavvia*.
. Dopo il riavvio dei servizi, vCenter Server viene visualizzato in verde nella pagina visualizzata.  Sia vCenter Server che SSO devono disporre dei parametri di configurazione appropriati, che dovrebbero essere gli stessi della pagina precedente.
+

NOTE: Questo processo dovrebbe richiedere circa 10-20 minuti affinché il plug-in venga aggiunto al vCenter Server.

+
image:gcpd-hcx-007.png["Screenshot che mostra il processo completato."]



====
.Passaggio 4: associare VMware HCX Connector on-premise a Google Cloud VMware Engine HCX Cloud Manager
[%collapsible%open]
====
Dopo aver distribuito e configurato HCX Connector su vCenter locale, stabilire la connessione a Cloud Manager aggiungendo l'associazione.  Per configurare l'associazione dei siti, completare i seguenti passaggi:

. Per creare una coppia di siti tra l'ambiente vCenter on-premise e Google Cloud VMware Engine SDDC, accedi al vCenter Server on-premise e apri il nuovo plug-in HCX vSphere Web Client.
+
image:gcpd-hcx-008.png["Screenshot del plug-in HCX vSphere Web Client."]

. In Infrastruttura, fare clic su *Aggiungi un'associazione di siti*.
+

NOTE: Immettere l'URL o l'indirizzo IP di Google Cloud VMware Engine HCX Cloud Manager e le credenziali dell'utente con privilegi Cloud-Owner-Role per accedere al cloud privato.

+
image:gcpd-hcx-009.png["URL dello screenshot o indirizzo IP e credenziali per il ruolo CloudOwner."]

. Fare clic su *Connetti*.
+

NOTE: VMware HCX Connector deve essere in grado di indirizzare all'IP di HCX Cloud Manager tramite la porta 443.

. Dopo aver creato l'associazione, l'associazione del sito appena configurata è disponibile sulla dashboard HCX.
+
image:gcpd-hcx-010.png["Screenshot del processo completato sulla dashboard HCX."]



====
.Passaggio 5: configurare il profilo di rete, il profilo di elaborazione e il service mesh
[%collapsible%open]
====
L'appliance di servizi VMware HCX Interconnect fornisce funzionalità di replicazione e migrazione basate su vMotion tramite Internet e connessioni private al sito di destinazione.  L'interconnessione fornisce crittografia, ingegneria del traffico e mobilità delle VM.  Per creare un'appliance di servizi Interconnect, completare i seguenti passaggi:

. In Infrastruttura, seleziona *Interconnessione > Multi-Site Service Mesh > Profili di calcolo > Crea profilo di calcolo*.
+

NOTE: I profili di calcolo definiscono i parametri di distribuzione, tra cui gli apparecchi distribuiti e la parte del data center VMware accessibile al servizio HCX.

+
image:gcpd-hcx-011.png["Screenshot della pagina Interconnessione del client vSphere."]

. Dopo aver creato il profilo di calcolo, creare i profili di rete selezionando *Multi-Site Service Mesh > Profili di rete > Crea profilo di rete*.
+
Il profilo di rete definisce un intervallo di indirizzi IP e reti utilizzati da HCX per i suoi dispositivi virtuali.

+

NOTE: Per questo passaggio sono necessari due o più indirizzi IP.  Questi indirizzi IP vengono assegnati dalla rete di gestione agli Interconnect Appliance.

+
image:gcpd-hcx-012.png["Screenshot del profilo di rete."]

. Al momento, i profili di calcolo e di rete sono stati creati correttamente.
. Creare il Service Mesh selezionando la scheda *Service Mesh* nell'opzione *Interconnessione* e selezionare i siti SDDC locali e GCVE.
. Service Mesh specifica una coppia di profili di rete e di elaborazione locali e remoti.
+

NOTE: Come parte di questo processo, gli appliance HCX vengono distribuiti e configurati automaticamente sia sul sito di origine che su quello di destinazione per creare un fabric di trasporto sicuro.

+
image:gcpd-hcx-013.png["Screenshot della scheda Service Mesh nella pagina Interconnessione del client vSphere."]

. Questo è il passaggio finale della configurazione.  Il completamento dell'implementazione dovrebbe richiedere circa 30 minuti.  Dopo aver configurato il service mesh, l'ambiente è pronto con i tunnel IPsec creati correttamente per migrare le VM del carico di lavoro.
+
image:gcpd-hcx-014.png["Screenshot degli HCX Appliance nella pagina Interconnessione del client vSphere."]



====
.Fase 6: Migrazione dei carichi di lavoro
[%collapsible%open]
====
I carichi di lavoro possono essere migrati in modo bidirezionale tra SDDC locali e GCVE utilizzando varie tecnologie di migrazione VMware HCX.  Le VM possono essere spostate da e verso entità attivate da VMware HCX utilizzando più tecnologie di migrazione, quali migrazione in blocco HCX, HCX vMotion, migrazione a freddo HCX, HCX Replication Assisted vMotion (disponibile con l'edizione HCX Enterprise) e migrazione assistita del sistema operativo HCX (disponibile con l'edizione HCX Enterprise).

Per saperne di più sui vari meccanismi di migrazione HCX, vedere https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["Documentazione sulla migrazione di VM VMware tramite VMware HCX"^] .

L'appliance HCX-IX utilizza il servizio Mobility Agent per eseguire migrazioni vMotion, Cold e Replication Assisted vMotion (RAV).


NOTE: L'appliance HCX-IX aggiunge il servizio Mobility Agent come oggetto host nel vCenter Server.  Le risorse di processore, memoria, storage e rete visualizzate su questo oggetto non rappresentano il consumo effettivo sull'hypervisor fisico che ospita l'appliance IX.

*HCX vMotion*

Questa sezione descrive il meccanismo HCX vMotion.  Questa tecnologia di migrazione utilizza il protocollo VMware vMotion per migrare una VM a GCVE.  L'opzione di migrazione vMotion viene utilizzata per migrare lo stato di una singola VM alla volta.  Durante questo metodo di migrazione non si verifica alcuna interruzione del servizio.


NOTE: È necessario che sia presente un'estensione di rete (per il gruppo di porte a cui è collegata la VM) per poter migrare la VM senza dover modificare l'indirizzo IP.

. Dal client vSphere on-premise, vai su Inventario, fai clic con il pulsante destro del mouse sulla VM da migrare e seleziona Azioni HCX > Migra al sito di destinazione HCX.
+
image:gcpd-hcx-015.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

. Nella procedura guidata Migra macchina virtuale, selezionare la connessione al sito remoto (GCVE di destinazione).
+
image:gcpd-hcx-016.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

. Aggiornare i campi obbligatori (Cluster, Storage e Rete di destinazione), quindi fare clic su Convalida.
+
image:gcpd-hcx-017.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

. Una volta completati i controlli di convalida, fare clic su Vai per avviare la migrazione.
+

NOTE: Il trasferimento vMotion cattura la memoria attiva della VM, il suo stato di esecuzione, il suo indirizzo IP e il suo indirizzo MAC.  Per ulteriori informazioni sui requisiti e le limitazioni di HCX vMotion, vedere https://techdocs.broadcom.com/us/en/vmware-cis/hcx/vmware-hcx/4-10/vmware-hcx-user-guide-4-10/migrating-virtual-machines-with-vmware-hcx/understanding-vmware-hcx-vmotion-and-cold-migration.html#GUID-517866F6-AF06-4EFC-8FAE-DA067418D584-en["Informazioni su VMware HCX vMotion e sulla migrazione a freddo"^] .

. È possibile monitorare l'avanzamento e il completamento di vMotion dalla dashboard HCX > Migrazione.
+
image:gcpd-hcx-018.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]




NOTE: Il datastore NFS di destinazione Google Cloud NetApp Volumes (NetApp Volumes) deve disporre di spazio sufficiente per gestire la migrazione.

====


== Conclusione

Che si punti a un cloud all-cloud o ibrido e che i dati risiedano su qualsiasi tipo/fornitore di storage in locale, Cloud Volume Service e HCX offrono ottime opzioni per distribuire e migrare i carichi di lavoro delle applicazioni, riducendo al contempo il TCO, rendendo i requisiti dei dati trasparenti per il livello applicativo.  Qualunque sia il caso d'uso, scegli Google Cloud VMware Engine insieme a Cloud Volume Service per ottenere rapidamente i vantaggi del cloud, un'infrastruttura e operazioni coerenti su cloud locali e multipli, portabilità bidirezionale dei carichi di lavoro e capacità e prestazioni di livello aziendale.  Si tratta dello stesso processo e delle stesse procedure note utilizzate per connettere lo storage e migrare le VM tramite VMware vSphere Replication, VMware vMotion o persino Network File Copy (NFC).



== Da asporto

I punti chiave di questo documento includono:

* Ora puoi utilizzare Cloud Volume Service come datastore su Google Cloud VMware Engine SDDC.
* È possibile migrare facilmente i dati dall'ambiente locale al datastore Cloud Volume Service.
* È possibile espandere e ridurre facilmente il datastore di Cloud Volume Service per soddisfare i requisiti di capacità e prestazioni durante l'attività di migrazione.




== Video di Google e VMware come riferimento

.Da Google
[%collapsible%open]
====
* link:https://www.youtube.com/watch?v=xZOtqiHY5Uw["Distribuisci HCX Connector con GCVE"]
* link:https://youtu.be/2ObPvekMlqA["Configurare HCX ServiceMesh con GCVE"]
* link:https://youtu.be/zQSGq4STX1s["Migrazione della VM con HCX a GCVE"]


====
.Da VMware
[%collapsible%open]
====
* link:https://youtu.be/EFE5ZYFit3M["Distribuzione del connettore HCX per GCVE"]
* link:https://youtu.be/uwRFFqbezIE["Configurazione HCX ServiceMesh per GCVE"]
* link:https://youtu.be/4KqL0Rxa3kM["Migrazione del carico di lavoro HCX a GCVE"]


====


== Dove trovare ulteriori informazioni

Per saperne di più sulle informazioni descritte nel presente documento, fare riferimento ai seguenti link del sito web:

* Documentazione di Google Cloud VMware Engine
+
https://cloud.google.com/vmware-engine/docs/overview/["https://cloud.google.com/vmware-engine/docs/overview"^]

* Documentazione del servizio Cloud Volume
+
https://cloud.google.com/architecture/partners/netapp-cloud-volumes["https://cloud.google.com/architecture/partners/netapp-cloud-volumes"^]

* Guida utente VMware HCX
+
https://docs.vmware.com/en/VMware-HCX/index.html["https://docs.vmware.com/en/VMware-HCX/index.html"^]


