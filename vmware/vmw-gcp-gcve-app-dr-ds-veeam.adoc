---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-app-dr-ds-veeam.html 
keywords: gcp, gcve, snapcenter, cvo, gcnv, iscsi, guest connect, dr, disaster recovery 
summary: Il disaster recovery sul cloud è un modo resiliente ed economico per proteggere i carichi di lavoro da interruzioni del sito ed eventi di danneggiamento dei dati come il ransomware.  Con NetApp SnapMirror, i carichi di lavoro VMware on-premise che utilizzano storage connesso agli ospiti possono essere replicati su NetApp Cloud Volumes ONTAP in esecuzione su Google Cloud. 
---
= Ripristino di emergenza coerente con le applicazioni con NetApp SnapCenter e Veeam Replication
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Il disaster recovery sul cloud è un modo resiliente ed economico per proteggere i carichi di lavoro da interruzioni del sito ed eventi di danneggiamento dei dati come il ransomware.  Con NetApp SnapMirror, i carichi di lavoro VMware on-premise che utilizzano storage connesso agli ospiti possono essere replicati su NetApp Cloud Volumes ONTAP in esecuzione su Google Cloud.



== Panoramica

Molti clienti sono alla ricerca di una soluzione efficace per il disaster recovery delle loro macchine virtuali applicative ospitate su VMware vSphere.  Molti di loro utilizzano la soluzione di backup esistente per eseguire il ripristino in caso di emergenza.  Spesso questa soluzione aumenta l'RTO e non soddisfa le aspettative.  Per ridurre RPO e RTO, la replica delle VM Veeam può essere utilizzata anche da on-prem a GCVE, purché siano disponibili connettività di rete e un ambiente con autorizzazioni appropriate.  NOTA: Veeam VM Replication non protegge i dispositivi di storage connessi alla VM guest, come i mount iSCSI o NFS all'interno della VM guest.  Bisogna proteggerli separatamente.

Per una replica coerente delle applicazioni per SQL VM e per ridurre l'RTO, abbiamo utilizzato SnapCenter per orchestrare le operazioni snapmirror del database SQL e dei volumi di registro.

Questo documento fornisce un approccio passo passo per configurare ed eseguire il disaster recovery utilizzando NetApp SnapMirror, Veeam e Google Cloud VMware Engine (GCVE).

image:dr-cvs-gcve-veeam-001.png["Architettura di replicazione delle VM delle applicazioni"]



== Ipotesi

Questo documento si concentra sull'archiviazione in-guest per i dati delle applicazioni (nota anche come guest connected) e presuppone che l'ambiente locale utilizzi SnapCenter per backup coerenti con le applicazioni.


NOTE: Il presente documento si applica a qualsiasi soluzione di backup o ripristino di terze parti.  A seconda della soluzione utilizzata nell'ambiente, seguire le best practice per creare policy di backup che soddisfino gli SLA aziendali.

Per la connettività tra l'ambiente on-premise e la rete Google Cloud, utilizzare opzioni di connettività come l'interconnessione dedicata o la VPN cloud.  I segmenti devono essere creati in base alla progettazione della VLAN locale.


NOTE: Esistono diverse opzioni per connettere i data center locali a Google Cloud, il che ci impedisce di descrivere un flusso di lavoro specifico in questo documento.  Per il metodo di connettività on-premise-a-Google più appropriato, fare riferimento alla documentazione di Google Cloud.



== Distribuzione della soluzione DR



=== Panoramica sulla distribuzione della soluzione

. Assicurarsi che i dati dell'applicazione vengano sottoposti a backup tramite SnapCenter con i requisiti RPO necessari.
. Eseguire il provisioning Cloud Volumes ONTAP con la dimensione corretta dell'istanza utilizzando BlueXP all'interno dell'abbonamento appropriato e della rete virtuale.
+
.. Configurare SnapMirror per i volumi applicativi pertinenti.
.. Aggiornare i criteri di backup in SnapCenter per attivare gli aggiornamenti SnapMirror dopo i processi pianificati.


. Installa il software Veeam e inizia a replicare le macchine virtuali sull'istanza Google Cloud VMware Engine.
. In caso di disastro, interrompi la relazione SnapMirror utilizzando BlueXP e attiva il failover delle macchine virtuali con Veeam.
+
.. Ricollegare i LUN ISCSI e i mount NFS per le VM dell'applicazione.
.. Pubblica le applicazioni online.


. Richiamare il failback sul sito protetto tramite la risincronizzazione inversa SnapMirror dopo il ripristino del sito primario.




=== Dettagli di distribuzione

.Configura CVO su Google Cloud e replica i volumi su CVO
[%collapsible%open]
====
Il primo passo è configurare Cloud Volumes ONTAP su Google Cloud (link:vmw-gcp-gcve-guest-storage.html["cvo"^] ) e replicare i volumi desiderati su Cloud Volumes ONTAP con le frequenze e le conservazioni degli snapshot desiderate.

image:dr-cvo-gcve-002.png["Figura che mostra il dialogo di input/output o che rappresenta il contenuto scritto"]

Per istruzioni dettagliate di esempio sulla configurazione SnapCenter e sulla replica dei dati, fare riferimento alink:vmw-aws-vmc-guest-storage-dr.html#config-snapmirror["Configurazione della replica con SnapCenter"]

.Revisione della protezione delle VM SQL con SnapCenter
video::395e33db-0d63-4e48-8898-b01200f006ca[panopto]
====
.Configurare gli host GCVE e l'accesso ai dati CVO
[%collapsible%open]
====
Due fattori importanti da considerare quando si implementa l'SDDC sono le dimensioni del cluster SDDC nella soluzione GCVE e per quanto tempo mantenere in servizio l'SDDC.  Queste due considerazioni chiave per una soluzione di disaster recovery contribuiscono a ridurre i costi operativi complessivi.  L'SDDC può essere composto da un minimo di tre host, fino a diventare un cluster multi-host in una distribuzione su larga scala.

Google Cloud NetApp Volumes per NFS Datastore e Cloud Volumes ONTAP per database e log SQL possono essere distribuiti su qualsiasi VPC e GCVE deve disporre di una connessione privata a tale VPC per montare il datastore NFS e far sì che la VM si connetta alle LUN iSCSI.

Per configurare GCVE SDDC, vederelink:vmw-gcp-gcve-setup.html["Distribuisci e configura l'ambiente di virtualizzazione su Google Cloud Platform (GCP)"^] .  Come prerequisito, verificare che le VM guest residenti sugli host GCVE siano in grado di utilizzare i dati da Cloud Volumes ONTAP dopo aver stabilito la connettività.

Dopo aver configurato correttamente Cloud Volumes ONTAP e GCVE, iniziare a configurare Veeam per automatizzare il ripristino dei carichi di lavoro on-premise su GCVE (VM con VMDK applicativi e VM con storage in-guest) utilizzando la funzionalità Veeam Replication e sfruttando SnapMirror per le copie dei volumi applicativi su Cloud Volumes ONTAP.

====
.Installa i componenti Veeam
[%collapsible%open]
====
In base allo scenario di distribuzione, il server di backup Veeam, il repository di backup e il proxy di backup che devono essere distribuiti.  Per questo caso d'uso, non è necessario distribuire l'archivio oggetti per Veeam e nemmeno il repository Scale-out è necessario. https://helpcenter.veeam.com/docs/backup/vsphere/replication_components.html?ver=120["Fare riferimento alla documentazione Veeam per la procedura di installazione"] Per ulteriori informazioni, fare riferimentolink:vmw-gcp-gcve-migrate-veeam.html["Migrazione con Veeam Replication"]

====
.Configurare la replica della VM con Veeam
[%collapsible%open]
====
Sia vCenter on-premise che vCenter GCVE devono essere registrati con Veeam. https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["Configurazione del processo di replica della VM vSphere"]  Nella fase di elaborazione guest della procedura guidata, selezionare Disabilita elaborazione applicazione poiché utilizzeremo SnapCenter per il backup e il ripristino basati sull'applicazione.

video::8b7e4a9b-7de1-4d48-a8e2-b01200f00692[panopto,width=360]
====
.Failover della VM di Microsoft SQL Server
[%collapsible%open]
====
video::9762dc99-081b-41a2-ac68-b01200f00ac0[panopto,width=360]
====


== Vantaggi di questa soluzione

* Utilizza la replica efficiente e resiliente di SnapMirror.
* Ripristina qualsiasi punto disponibile nel tempo con la conservazione degli snapshot ONTAP .
* È disponibile l'automazione completa per tutti i passaggi necessari al ripristino di centinaia o migliaia di VM, a partire dalle fasi di archiviazione, elaborazione, rete e convalida delle applicazioni.
* SnapCenter utilizza meccanismi di clonazione che non modificano il volume replicato.
+
** In questo modo si evita il rischio di danneggiamento dei dati per volumi e snapshot.
** Evita interruzioni della replicazione durante i flussi di lavoro dei test DR.
** Sfrutta i dati DR per flussi di lavoro che vanno oltre il DR, come sviluppo/test, test di sicurezza, test di patch e aggiornamenti e test di correzione.


* Veeam Replication consente di modificare gli indirizzi IP delle VM sul sito DR.

