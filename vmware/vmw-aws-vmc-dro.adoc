---
sidebar: sidebar 
permalink: vmware/vmw-aws-vmc-dro.html 
keywords: NetApp Solutions, hybrid, multicloud, multi cloud, hyperscalers, vmware, disaster recovery orchestrator, DRO 
summary:  
---
= TR-4955: Disaster Recovery con FSx ONTAP e VMC (AWS VMware Cloud)
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Disaster Recovery Orchestrator (DRO; una soluzione con script e interfaccia utente) può essere utilizzato per ripristinare senza problemi i carichi di lavoro replicati da locale a FSx ONTAP.  DRO automatizza il ripristino dal livello SnapMirror , tramite la registrazione della VM su VMC, fino alle mappature di rete direttamente su NSX-T. Questa funzionalità è inclusa in tutti gli ambienti VMC.

Niyaz Mohamed, NetApp



== Panoramica

Il disaster recovery nel cloud è un modo resiliente ed economico per proteggere i carichi di lavoro da interruzioni del sito ed eventi di danneggiamento dei dati (ad esempio, ransomware).  Grazie alla tecnologia NetApp SnapMirror , i carichi di lavoro VMware on-premise possono essere replicati su FSx ONTAP in esecuzione su AWS.

Disaster Recovery Orchestrator (DRO; una soluzione con script e interfaccia utente) può essere utilizzato per ripristinare senza problemi i carichi di lavoro replicati da locale a FSx ONTAP.  DRO automatizza il ripristino dal livello SnapMirror , tramite la registrazione della VM su VMC, fino alle mappature di rete direttamente su NSX-T. Questa funzionalità è inclusa in tutti gli ambienti VMC.

image:dro-vmc-001.png["Questo grafico illustra la struttura e le interconnessioni tra un data center locale, un'istanza VMware Cloud on AWS SDDC e Amazon FSx ONTAP.  Ciò include la replica SnapMirror , il traffico DRaaS Ops, la connessione Internet o diretta e VMware Transit Connect."]



== Iniziare



=== Distribuisci e configura VMware Cloud su AWS

link:https://www.vmware.com/products/vmc-on-aws.html["VMware Cloud su AWS"^]fornisce un'esperienza cloud-native per carichi di lavoro basati su VMware nell'ecosistema AWS.  Ogni VMware Software-Defined Data Center (SDDC) viene eseguito in un Amazon Virtual Private Cloud (VPC) e fornisce uno stack VMware completo (incluso vCenter Server), networking software-defined NSX-T, storage software-defined vSAN e uno o più host ESXi che forniscono risorse di elaborazione e storage ai carichi di lavoro.  Per configurare un ambiente VMC su AWS, seguire i passaggi riportati di seguitolink:vmw-aws-vmc-setup.html["collegamento"^] .  Per scopi DR è possibile utilizzare anche un gruppo di spie luminose.


NOTE: Nella versione iniziale, DRO supporta un cluster di spie luminose esistente.  La creazione di SDDC su richiesta sarà disponibile in una prossima versione.



=== Fornire e configurare FSx ONTAP

Amazon FSx ONTAP è un servizio completamente gestito che fornisce un archivio file altamente affidabile, scalabile, ad alte prestazioni e ricco di funzionalità, basato sul famoso file system NetApp ONTAP .  Segui i passaggi quilink:vmw-aws-vmc-nfs-ds-overview.html["collegamento"^] per fornire e configurare FSx ONTAP.



=== Distribuisci e configura SnapMirror su FSx ONTAP

Il passaggio successivo consiste nell'utilizzare NetApp BlueXP e individuare l'istanza FSx ONTAP su AWS fornita e replicare i volumi del datastore desiderati da un ambiente locale a FSx ONTAP con la frequenza appropriata e la conservazione delle copie Snapshot NetApp :

image:dro-vmc-002.png["Questa grafica illustra la mappa delle relazioni di BlueXP Canvas che mostra le varie interazioni tra i servizi abilitati."]

Per configurare BlueXP, segui i passaggi indicati in questo link.  È anche possibile utilizzare NetApp ONTAP CLI per pianificare la replica seguendo questo collegamento.


NOTE: Una relazione SnapMirror è un prerequisito e deve essere creata in anticipo.



== Installazione DRO

Per iniziare a usare DRO, utilizza il sistema operativo Ubuntu su un'istanza EC2 o una macchina virtuale designata per assicurarti di soddisfare i prerequisiti.  Quindi installare il pacchetto.



=== Prerequisiti

* Assicurarsi che esista la connettività con i sistemi vCenter e di storage di origine e di destinazione.
* Se si utilizzano nomi DNS, è necessario che sia attiva la risoluzione DNS.  In caso contrario, è necessario utilizzare indirizzi IP per i sistemi vCenter e di storage.
* Creare un utente con permessi di root.  È possibile utilizzare sudo anche con un'istanza EC2.




=== Requisiti OS

* Ubuntu 20.04 (LTS) con un minimo di 2 GB e 4 vCPU
* I seguenti pacchetti devono essere installati sulla VM dell'agente designata:
+
** Docker
** Docker-compose
** Jq




Cambia i permessi su `docker.sock` : `sudo chmod 666 /var/run/docker.sock` .


NOTE: IL `deploy.sh` lo script esegue tutti i prerequisiti richiesti.



=== Installa il pacchetto

. Scaricare il pacchetto di installazione sulla macchina virtuale designata:
+
[listing]
----
git clone https://github.com/NetApp/DRO-AWS.git
----
+

NOTE: L'agente può essere installato in locale o all'interno di una VPC AWS.

. Decomprimi il pacchetto, esegui lo script di distribuzione e inserisci l'IP dell'host (ad esempio, 10.10.10.10).
+
[listing]
----
tar xvf DRO-prereq.tar
----
. Passare alla directory ed eseguire lo script di distribuzione come segue:
+
[listing]
----
sudo sh deploy.sh
----
. Accedi all'interfaccia utente tramite:
+
[listing]
----
https://<host-ip-address>
----
+
con le seguenti credenziali predefinite:

+
[listing]
----
Username: admin
Password: admin
----



NOTE: La password può essere modificata utilizzando l'opzione "Cambia password".

image:dro-vmc-003.png["Schermata di accesso a Disaster Recovery Orchestrator."]



== Configurazione DRO

Dopo aver configurato correttamente FSx ONTAP e VMC, è possibile iniziare a configurare DRO per automatizzare il ripristino dei carichi di lavoro locali su VMC utilizzando le copie SnapMirror di sola lettura su FSx ONTAP.

NetApp consiglia di distribuire l'agente DRO in AWS e anche nella stessa VPC in cui è distribuito FSx ONTAP (può anche essere connessa tramite peer), in modo che l'agente DRO possa comunicare tramite la rete con i componenti locali e con le risorse FSx ONTAP e VMC.

Il primo passo è individuare e aggiungere le risorse on-premise e cloud (sia vCenter che storage) a DRO.  Aprire DRO in un browser supportato e utilizzare il nome utente e la password predefiniti (admin/admin) e Aggiungi siti.  È possibile aggiungere siti anche tramite l'opzione Scopri.  Aggiungere le seguenti piattaforme:

* In sede
+
** vCenter locale
** Sistema di archiviazione ONTAP


* Nuvola
+
** VMC vCenter
** FSx ONTAP




image:dro-vmc-004.png["Descrizione dell'immagine segnaposto temporanea."]

image:dro-vmc-005.png["Pagina di panoramica del sito DRO contenente i siti di origine e di destinazione."]

Una volta aggiunto, DRO esegue la rilevazione automatica e visualizza le VM che dispongono delle repliche SnapMirror corrispondenti dall'archiviazione di origine a FSx ONTAP.  DRO rileva automaticamente le reti e i gruppi di porte utilizzati dalle VM e li popola.

image:dro-vmc-006.png["Schermata di rilevamento automatico contenente 219 VM e 10 datastore."]

Il passaggio successivo consiste nel raggruppare le VM necessarie in gruppi funzionali che fungeranno da gruppi di risorse.



=== Raggruppamenti di risorse

Dopo aver aggiunto le piattaforme, è possibile raggruppare le VM che si desidera ripristinare in gruppi di risorse.  I gruppi di risorse DRO consentono di raggruppare un set di VM dipendenti in gruppi logici che contengono i relativi ordini di avvio, ritardi di avvio e convalide facoltative delle applicazioni che possono essere eseguite al momento del ripristino.

Per iniziare a creare gruppi di risorse, completare i seguenti passaggi:

. Accedi a *Gruppi di risorse* e fai clic su *Crea nuovo gruppo di risorse*.
. In *Nuovo gruppo di risorse*, seleziona il sito di origine dal menu a discesa e fai clic su *Crea*.
. Fornisci *Dettagli del gruppo di risorse* e fai clic su *Continua*.
. Selezionare le VM appropriate utilizzando l'opzione di ricerca.
. Selezionare l'ordine di avvio e il ritardo di avvio (secondi) per le VM selezionate.  Imposta l'ordine della sequenza di accensione selezionando ogni VM e impostandone la priorità.  Tre è il valore predefinito per tutte le VM.
+
Le opzioni sono le seguenti:

+
1 – La prima macchina virtuale ad accendersi 3 – Predefinito 5 – L’ultima macchina virtuale ad accendersi

. Fare clic su *Crea gruppo di risorse*.


image:dro-vmc-007.png["Screenshot dell'elenco dei gruppi di risorse con due voci: Test e DemoRG1."]



=== Piani di replicazione

È necessario un piano per ripristinare le applicazioni in caso di disastro.  Selezionare le piattaforme vCenter di origine e di destinazione dal menu a discesa e scegliere i gruppi di risorse da includere in questo piano, insieme al raggruppamento delle modalità di ripristino e accensione delle applicazioni (ad esempio, controller di dominio, quindi livello 1, quindi livello 2 e così via).  Tali piani sono talvolta chiamati anche blueprint.  Per definire il piano di ripristino, accedere alla scheda *Piano di replica* e fare clic su *Nuovo piano di replica*.

Per iniziare a creare un piano di replicazione, completare i seguenti passaggi:

. Accedi a *Piani di replicazione* e fai clic su *Crea nuovo piano di replicazione*.
+
image:dro-vmc-008.png["Screenshot della schermata del piano di replicazione contenente un piano denominato DemoRP."]

. In *Nuovo piano di replica*, specificare un nome per il piano e aggiungere i mapping di ripristino selezionando il sito di origine, il vCenter associato, il sito di destinazione e il vCenter associato.
+
image:dro-vmc-009.png["Screenshot dei dettagli del piano di replica, inclusa la mappatura del ripristino."]

. Una volta completata la mappatura del ripristino, selezionare la mappatura del cluster.
+
image:dro-vmc-010.png["Descrizione dell'immagine segnaposto temporanea."]

. Selezionare *Dettagli gruppo di risorse* e fare clic su *Continua*.
. Imposta l'ordine di esecuzione per il gruppo di risorse.  Questa opzione consente di selezionare la sequenza delle operazioni quando sono presenti più gruppi di risorse.
. Una volta terminato, seleziona la mappatura di rete sul segmento appropriato.  I segmenti dovrebbero essere già predisposti in VMC, quindi seleziona il segmento appropriato per mappare la VM.
. In base alla selezione delle VM, vengono selezionate automaticamente le mappature dei datastore.
+

NOTE: SnapMirror è al livello del volume.  Pertanto, tutte le VM vengono replicate nella destinazione di replica.  Assicurati di selezionare tutte le VM che fanno parte del datastore.  Se non vengono selezionate, vengono elaborate solo le VM che fanno parte del piano di replica.

+
image:dro-vmc-011.png["Descrizione dell'immagine segnaposto temporanea."]

. Nei dettagli della VM è possibile ridimensionare facoltativamente i parametri CPU e RAM della VM; questa opzione può essere molto utile quando si ripristinano ambienti di grandi dimensioni in cluster di destinazione più piccoli o per eseguire test DR senza dover predisporre un'infrastruttura VMware fisica uno a uno.  Inoltre, è possibile modificare l'ordine di avvio e il ritardo di avvio (secondi) per tutte le VM selezionate nei gruppi di risorse.  Esiste un'opzione aggiuntiva per modificare l'ordine di avvio se sono necessarie modifiche rispetto a quelle selezionate durante la selezione dell'ordine di avvio del gruppo di risorse.  Per impostazione predefinita, viene utilizzato l'ordine di avvio selezionato durante la selezione del gruppo di risorse; tuttavia, è possibile apportare modifiche in questa fase.
+
image:dro-vmc-012.png["Descrizione dell'immagine segnaposto temporanea."]

. Fare clic su *Crea piano di replicazione*.
+
image:dro-vmc-013.png["Descrizione dell'immagine segnaposto temporanea."]



Dopo aver creato il piano di replicazione, è possibile utilizzare l'opzione failover, l'opzione test-failover o l'opzione migrazione, a seconda dei requisiti.  Durante le opzioni di failover e test-failover, viene utilizzata la copia Snapshot SnapMirror più recente oppure è possibile selezionare una copia Snapshot specifica da una copia Snapshot point-in-time (in base ai criteri di conservazione di SnapMirror).  L'opzione point-in-time può essere molto utile se si sta affrontando un evento di corruzione come un ransomware, in cui le repliche più recenti sono già compromesse o crittografate.  DRO mostra tutti i punti disponibili nel tempo.  Per attivare il failover o il failover di prova con la configurazione specificata nel piano di replica, è possibile fare clic su *Failover* o *Failover di prova*.

image:dro-vmc-014.png["Descrizione dell'immagine segnaposto temporanea."] image:dro-vmc-015.png["In questa schermata vengono forniti i dettagli dello snapshot del volume e viene data la possibilità di scegliere se utilizzare lo snapshot più recente o sceglierne uno specifico."]

Il piano di replicazione può essere monitorato nel menu delle attività:

image:dro-vmc-016.png["Il menu delle attività mostra tutti i lavori e le opzioni per il piano di replicazione e consente anche di visualizzare i registri."]

Dopo l'attivazione del failover, gli elementi recuperati possono essere visualizzati nel VMC vCenter (VM, reti, datastore).  Per impostazione predefinita, le VM vengono ripristinate nella cartella Workload.

image:dro-vmc-017.png["Descrizione dell'immagine segnaposto temporanea."]

Il failback può essere attivato a livello del piano di replicazione.  Per un failover di test, è possibile utilizzare l'opzione tear-down per annullare le modifiche e rimuovere la relazione FlexClone .  Il failback correlato al failover è un processo in due fasi.  Selezionare il piano di replicazione e selezionare *Sincronizzazione dati inversa*.

image:dro-vmc-018.png["Screenshot della panoramica del piano di replica con menu a discesa contenente l'opzione Sincronizzazione dati inversa."] image:dro-vmc-019.png["Descrizione dell'immagine segnaposto temporanea."]

Una volta completato, è possibile attivare il failback per tornare al sito di produzione originale.

image:dro-vmc-020.png["Screenshot della panoramica del piano di replica con menu a discesa contenente l'opzione Failback."] image:dro-vmc-021.png["Screenshot della pagina di riepilogo DRO con il sito di produzione originale attivo e funzionante."]

Da NetApp BlueXP, possiamo vedere che lo stato di replicazione si è interrotto per i volumi appropriati (quelli che erano stati mappati su VMC come volumi di lettura-scrittura).  Durante il failover di prova, DRO non mappa il volume di destinazione o di replica.  Al contrario, crea una copia FlexClone dell'istanza SnapMirror (o Snapshot) richiesta ed espone l'istanza FlexClone , che non consuma ulteriore capacità fisica per FSx ONTAP.  Questo processo garantisce che il volume non venga modificato e che i processi di replica possano continuare anche durante i test DR o i flussi di lavoro di triage.  Inoltre, questo processo garantisce che, se si verificano errori o vengono recuperati dati danneggiati, il ripristino può essere ripulito senza il rischio che la replica venga distrutta.

image:dro-vmc-022.png["Descrizione dell'immagine segnaposto temporanea."]



=== Recupero da ransomware

Recuperare i dati da un ransomware può essere un compito arduo.  Nello specifico, può essere difficile per le organizzazioni IT individuare con precisione il punto di ritorno sicuro e, una volta determinato, proteggere i carichi di lavoro recuperati da attacchi ricorrenti, ad esempio da malware inattivi o applicazioni vulnerabili.

DRO risolve questi problemi consentendoti di ripristinare il tuo sistema da qualsiasi momento disponibile.  È anche possibile ripristinare i carichi di lavoro su reti funzionali ma isolate, in modo che le applicazioni possano funzionare e comunicare tra loro in una posizione in cui non siano esposte al traffico nord-sud.  In questo modo, il tuo team addetto alla sicurezza avrà a disposizione un luogo sicuro in cui svolgere analisi forensi e assicurarsi che non vi siano malware nascosti o inattivi.



== Benefici

* Utilizzo della replica efficiente e resiliente SnapMirror .
* Ripristino in qualsiasi momento disponibile con conservazione della copia Snapshot.
* Automazione completa di tutti i passaggi necessari per ripristinare centinaia o migliaia di VM dalle fasi di archiviazione, elaborazione, rete e convalida delle applicazioni.
* Ripristino del carico di lavoro con la tecnologia ONTAP FlexClone utilizzando un metodo che non modifica il volume replicato.
+
** Evita il rischio di danneggiamento dei dati per volumi o copie Snapshot.
** Evita interruzioni della replicazione durante i flussi di lavoro dei test DR.
** Potenziale utilizzo dei dati DR con risorse di cloud computing per flussi di lavoro che vanno oltre il DR, come DevTest, test di sicurezza, test di patch o aggiornamento e test di correzione.


* Ottimizzazione di CPU e RAM per contribuire a ridurre i costi del cloud consentendo il ripristino su cluster di elaborazione più piccoli.

